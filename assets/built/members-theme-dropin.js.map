{"version":3,"sources":["members-theme-dropin.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","layer1","options","authUrl","concat","membersUrl","gatewayUrl","container","members","loadAuth","src","arguments","undefined","document","body","Promise","resolve","frame","createElement","style","display","onload","appendChild","loadFrame","then","position","width","height","background","top","openAuth","hash","query","window","addEventListener","messageListener","event","source","contentWindow","data","msg","removeEventListener","success","Object","assign","bus","getToken","_ref2","audience","signout","signin","upgrade","resetPassword","_ref","token","@tryghost/members-layer1","2","layer0","events","gatewayFn","method","opts","gateway","reject","err","res","loadGateway","email","password","signup","_ref3","name","requestPasswordReset","_ref4","_ref5","verifyEmail","_ref6","init","listen","emit","payload","@tryghost/members-layer0","minivents","3","getuid","origin","URL","getAttribute","handlers","listener","uid","handler","error","cb","postMessage","fn","4","this","on","l","push","off","splice","slice","apply","5","_typeof","obj","Symbol","iterator","constructor","prototype","definition","define","amd","_listener","fns","doc","hack","documentElement","doScroll","domContentLoaded","loaded","test","readyState","shift","setTimeout","6","_slicedToArray","arr","Array","isArray","_arrayWithHoles","_arr","_n","_d","_e","_s","_i","next","done","value","_iterableToArrayLimit","TypeError","_nonIterableRest","domready","layer2","reload","location","getClaims","_token$split2","split","claims","JSON","parse","atob","replace","tokenAudience","href","match","hashMatch","tokenMatch","signinEls","querySelectorAll","upgradeEls","signoutEls","setCookie","expiry","Date","exp","cookie","toUTCString","removeCookie","preventDefault","currentCookies","currentToken","now","isTokenExpired","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","el","return","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_el","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_el2","@tryghost/members-layer2"],"mappings":"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","file":"members-theme-dropin.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n/* global document window */\nvar layer1 = require('@tryghost/members-layer1');\n\nmodule.exports = function layer2(options) {\n  var authUrl = \"\".concat(options.membersUrl, \"/auth\");\n  var gatewayUrl = \"\".concat(options.membersUrl, \"/gateway\");\n  var container = options.container;\n  var members = layer1({\n    gatewayUrl: gatewayUrl,\n    container: container\n  });\n  var loadAuth = loadFrame(authUrl, container).then(function (frame) {\n    frame.style.position = 'fixed';\n    frame.style.width = '100%';\n    frame.style.height = '100%';\n    frame.style.background = 'transparent';\n    frame.style.top = '0';\n    frame.style['z-index'] = '9999';\n    return frame;\n  });\n\n  function openAuth(hash) {\n    var query = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return loadAuth.then(function (frame) {\n      return new Promise(function (resolve) {\n        frame.src = \"\".concat(authUrl, \"#\").concat(hash, \"?\").concat(query);\n        frame.style.display = 'block';\n        window.addEventListener('message', function messageListener(event) {\n          if (event.source !== frame.contentWindow) {\n            return;\n          }\n\n          if (!event.data || event.data.msg !== 'pls-close-auth-popup') {\n            return;\n          }\n\n          window.removeEventListener('message', messageListener);\n          frame.style.display = 'none';\n          resolve(!!event.data.success);\n        });\n      });\n    });\n  }\n\n  function resetPassword(_ref) {\n    var token = _ref.token;\n    var query = \"token=\".concat(token);\n    return openAuth('reset-password', query);\n  }\n\n  function signin() {\n    return openAuth('signin');\n  }\n\n  function upgrade() {\n    return openAuth('upgrade');\n  }\n\n  function getToken(_ref2) {\n    var audience = _ref2.audience;\n    return members.getToken({\n      audience: audience\n    });\n  }\n\n  function signout() {\n    return members.signout();\n  }\n\n  return Object.assign(members.bus, {\n    getToken: getToken,\n    signout: signout,\n    signin: signin,\n    upgrade: upgrade,\n    resetPassword: resetPassword\n  });\n};\n\nfunction loadFrame(src) {\n  var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n  return new Promise(function (resolve) {\n    var frame = document.createElement('iframe');\n    frame.style.display = 'none';\n    frame.src = src;\n\n    frame.onload = function () {\n      resolve(frame);\n    };\n\n    container.appendChild(frame);\n  });\n}\n\n},{\"@tryghost/members-layer1\":2}],2:[function(require,module,exports){\n\"use strict\";\n\n/* global document */\nvar layer0 = require('@tryghost/members-layer0');\n\nvar events = require('minivents');\n\nmodule.exports = function layer1(options) {\n  var members = {\n    getToken: getToken,\n    signout: signout,\n    signin: signin,\n    signup: signup,\n    requestPasswordReset: requestPasswordReset,\n    resetPassword: resetPassword,\n    verifyEmail: verifyEmail,\n    bus: new events()\n  };\n  var loadGateway = loadFrame(options.gatewayUrl, options.container).then(function (frame) {\n    var gateway = layer0(frame);\n    var init = gatewayFn('init');\n    gateway.listen(function (data) {\n      members.bus.emit(data.event, data.payload);\n    });\n    return init(gateway).then(function () {\n      return gateway;\n    });\n  });\n\n  function getToken(_ref) {\n    var audience = _ref.audience;\n    return loadGateway.then(gatewayFn('getToken', {\n      audience: audience\n    }));\n  }\n\n  function signout() {\n    return loadGateway.then(gatewayFn('signout'));\n  }\n\n  function signin(_ref2) {\n    var email = _ref2.email,\n        password = _ref2.password;\n    return loadGateway.then(gatewayFn('signin', {\n      email: email,\n      password: password\n    }));\n  }\n\n  function signup(_ref3) {\n    var name = _ref3.name,\n        email = _ref3.email,\n        password = _ref3.password;\n    return loadGateway.then(gatewayFn('signin', {\n      name: name,\n      email: email,\n      password: password\n    }));\n  }\n\n  function requestPasswordReset(_ref4) {\n    var email = _ref4.email;\n    return loadGateway.then(gatewayFn('request-password-reset', {\n      email: email\n    }));\n  }\n\n  function resetPassword(_ref5) {\n    var token = _ref5.token,\n        password = _ref5.password;\n    return loadGateway.then(gatewayFn('reset-password', {\n      token: token,\n      password: password\n    }));\n  }\n\n  function verifyEmail(_ref6) {\n    var token = _ref6.token;\n    return loadGateway.then(gatewayFn('verify-email', {\n      token: token\n    }));\n  }\n\n  return members;\n};\n\nfunction gatewayFn(method) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return function (gateway) {\n    return new Promise(function (resolve, reject) {\n      gateway.call(method, opts, function (err, res) {\n        if (err) {\n          reject(err);\n        }\n\n        resolve(res);\n      });\n    });\n  };\n}\n\nfunction loadFrame(src) {\n  var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n  return new Promise(function (resolve) {\n    var frame = document.createElement('iframe');\n    frame.style.display = 'none';\n    frame.src = src;\n\n    frame.onload = function () {\n      resolve(frame);\n    };\n\n    container.appendChild(frame);\n  });\n}\n\n},{\"@tryghost/members-layer0\":3,\"minivents\":4}],3:[function(require,module,exports){\n\"use strict\";\n\n/* globals window */\nmodule.exports = function layer0(frame) {\n  var getuid = function (i) {\n    return function () {\n      return i += 1;\n    };\n  }(1);\n\n  var origin = new URL(frame.getAttribute('src')).origin;\n  var handlers = {};\n\n  var listener = function listener() {};\n\n  window.addEventListener('message', function (event) {\n    if (event.origin !== origin) {\n      return;\n    }\n\n    if (!event.data || !event.data.uid) {\n      if (event.data.event) {\n        return listener(event.data);\n      }\n\n      return;\n    }\n\n    var handler = handlers[event.data.uid];\n\n    if (!handler) {\n      return;\n    }\n\n    delete handlers[event.data.uid];\n    handler(event.data.error, event.data.data);\n  });\n\n  function call(method, options, cb) {\n    var uid = getuid();\n    var data = {\n      uid: uid,\n      method: method,\n      options: options\n    };\n    handlers[uid] = cb;\n    frame.contentWindow.postMessage(data, origin);\n  }\n\n  function listen(fn) {\n    listener = fn;\n  }\n\n  return {\n    call: call,\n    listen: listen\n  };\n};\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\n\nmodule.exports = function (n) {\n  var t = {},\n      e = [];\n  n = n || this, n.on = function (e, r, l) {\n    return (t[e] = t[e] || []).push([r, l]), n;\n  }, n.off = function (r, l) {\n    r || (t = {});\n\n    for (var o = t[r] || e, u = o.length = l ? o.length : 0; u--;) {\n      l == o[u][0] && o.splice(u, 1);\n    }\n\n    return n;\n  }, n.emit = function (r) {\n    for (var l, o = t[r] || e, u = o.length > 0 ? o.slice(0, o.length) : o, i = 0; l = u[i++];) {\n      l[0].apply(l[1], e.slice.call(arguments, 1));\n    }\n\n    return n;\n  };\n};\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/*!\n  * domready (c) Dustin Diaz 2014 - License MIT\n  */\n!function (name, definition) {\n  if (typeof module != 'undefined') module.exports = definition();else if (typeof define == 'function' && _typeof(define.amd) == 'object') define(definition);else this[name] = definition();\n}('domready', function () {\n  var fns = [],\n      _listener,\n      doc = document,\n      hack = doc.documentElement.doScroll,\n      domContentLoaded = 'DOMContentLoaded',\n      loaded = (hack ? /^loaded|^c/ : /^loaded|^i|^c/).test(doc.readyState);\n\n  if (!loaded) doc.addEventListener(domContentLoaded, _listener = function listener() {\n    doc.removeEventListener(domContentLoaded, _listener);\n    loaded = 1;\n\n    while (_listener = fns.shift()) {\n      _listener();\n    }\n  });\n  return function (fn) {\n    loaded ? setTimeout(fn, 0) : fns.push(fn);\n  };\n});\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n/* global window document atob */\nvar domready = require('domready');\n\nvar layer2 = require('@tryghost/members-layer2');\n\ndomready(setupMembersListeners);\n\nfunction reload(success) {\n  if (success) {\n    window.location.reload();\n  }\n}\n\nfunction setupMembersListeners() {\n  var members = layer2({\n    membersUrl: window.membersUrl\n  });\n  var tokenAudience = new URL(window.location.href).origin;\n\n  var _ref = window.location.hash.match(/^#([^?]+)\\??(.*)$/) || [],\n      _ref2 = _slicedToArray(_ref, 3),\n      hashMatch = _ref2[0],\n      hash = _ref2[1],\n      query = _ref2[2];\n\n  if (hashMatch && hash === 'reset-password') {\n    var _ref3 = query.match(/token=([a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+)/) || [],\n        _ref4 = _slicedToArray(_ref3, 2),\n        tokenMatch = _ref4[0],\n        token = _ref4[1];\n\n    if (tokenMatch) {\n      return members.resetPassword({\n        token: token\n      }).then(function (success) {\n        window.location.hash = '';\n        return success;\n      }).then(reload);\n    }\n  }\n\n  var signinEls = document.querySelectorAll('[data-members-signin]');\n  var upgradeEls = document.querySelectorAll('[data-members-upgrade]');\n  var signoutEls = document.querySelectorAll('[data-members-signout]');\n\n  function setCookie(token) {\n    var claims = getClaims(token);\n    var expiry = new Date(claims.exp * 1000);\n    document.cookie = 'member=' + token + ';Path=/;expires=' + expiry.toUTCString();\n  }\n\n  function removeCookie() {\n    document.cookie = 'member=null;Path=/;max-age=0';\n  }\n\n  members.on('signedin', function () {\n    var currentCookies = document.cookie;\n\n    var _ref5 = currentCookies.match(/member=([a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]*)/) || [null],\n        _ref6 = _slicedToArray(_ref5, 2),\n        hasCurrentToken = _ref6[0],\n        currentToken = _ref6[1]; // eslint-disable-line no-unused-vars\n\n\n    if (currentToken && isTokenExpired(currentToken)) {\n      return members.signout();\n    }\n\n    members.getToken({\n      audience: tokenAudience\n    }).then(function (token) {\n      setCookie(token);\n    });\n  });\n  members.on('signedout', function () {\n    removeCookie();\n  });\n\n  function signout(event) {\n    event.preventDefault();\n    members.signout().then(function () {\n      removeCookie();\n      return true;\n    }).then(reload);\n  }\n\n  function signin(event) {\n    event.preventDefault();\n    members.signin().then(function () {\n      return members.getToken({\n        audience: tokenAudience\n      }).then(function (token) {\n        setCookie(token);\n        return true;\n      });\n    }).then(reload);\n  }\n\n  function upgrade(event) {\n    event.preventDefault();\n    members.upgrade().then(reload);\n  }\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = signinEls[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var el = _step.value;\n      el.addEventListener('click', signin);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = upgradeEls[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var _el = _step2.value;\n\n      _el.addEventListener('click', upgrade);\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = signoutEls[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var _el2 = _step3.value;\n\n      _el2.addEventListener('click', signout);\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n}\n\nfunction isTokenExpired(token) {\n  var claims = getClaims(token);\n\n  if (!claims) {\n    return true;\n  }\n\n  var expiry = claims.exp * 1000;\n  var now = Date.now();\n\n  if (expiry < now) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction getClaims(token) {\n  try {\n    var _token$split = token.split('.'),\n        _token$split2 = _slicedToArray(_token$split, 3),\n        header = _token$split2[0],\n        claims = _token$split2[1],\n        signature = _token$split2[2]; // eslint-disable-line no-unused-vars\n\n\n    var parsedClaims = JSON.parse(atob(claims.replace('+', '-').replace('/', '_')));\n    return parsedClaims;\n  } catch (e) {\n    return null;\n  }\n}\n\n},{\"@tryghost/members-layer2\":1,\"domready\":5}]},{},[6]);\n"],"sourceRoot":"/source/"}